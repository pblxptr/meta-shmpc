#@TYPE: Machine
#@NAME: Henhouse Controller based on RPI Zero W
#@DESCRIPTION: Henhouse Controller

require conf/machine/raspberrypi0-wifi.conf

MACHINEOVERRIDES =. "raspberrypi0-wifi:"

MACHINE_FEATURES_remove = " screen touchscreen alsa"

### Kernel modules ###
MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS_append += "kernel-module-hatch2sr"

### Without this, there is an additional check in runtime and write to inittab
SERIAL_CONSOLES_CHECK = ""

### HW PWM support on board ###
KERNEL_DEVICETREE_append = " overlays/pwm.dtbo"
KERNEL_DEVICETREE_append = " overlays/hatch2sr.dtbo"

### RPI layer options
# Enable Uboot
RPI_USE_U_BOOT = "1"

# Enable uart
ENABLE_UART = "1"

# Config -> add options to /boot/config.txt
RPI_EXTRA_CONFIG_append = "dtoverlay=pwm,pin=12,func=4\n"
RPI_EXTRA_CONFIG_append = "dtoverlay=hatch2sr\n"
